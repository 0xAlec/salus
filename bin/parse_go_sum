#!/usr/bin/env ruby

require 'json'

parsed_file = nil
begin
  parsed_file = File.read(ARGV[0])
rescue StandardError
  warn 'Unable to read and parse go.sum file'
  exit(1)
end

dependencies = []

parsed_file.each_line do |line|
  parts = line.split
  if parts.length == 3
    names = parts[0].split("/")
    dependencies.append(
      {
        "namespace" => names[0..-2].join("/").to_s,
        "name" => names[-1].to_s,
        "version" => parts[1].to_s.gsub('/go.mod', ''),
        "checksum" => parts[2].to_s.gsub('h1:', '')
      }
    )
  end
end

puts dependencies.to_json
