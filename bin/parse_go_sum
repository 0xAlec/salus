#!/usr/bin/env ruby

require 'json'

parsed_file = File.read(ARGV[0])

dependencies = []

parsed_file.each_line do |line|
  # Split on space
  # Example - github.com/google/go-cmp v0.5.3/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=
  # Validate 3 parts - name, version and checksum
  parts = line.split
  if parts.length == 3
    names = parts[0].split("/")
    dependencies.append(
      {
        "namespace" => names[0..-2].join("/").to_s,
        "name" => names[-1].to_s,
        "version" => parts[1].to_s.gsub('/go.mod', ''),
        "checksum" => parts[2].to_s.gsub('h1:', '')
      }
    )
  end
end

puts dependencies.to_json
